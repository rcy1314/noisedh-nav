<!-- ÂºπÁ™óÊèêÈÜí -->
<div id="welcome-popup" class="popup" style="display: none;">
    <div class="popup-content">
        <p class="large-text">üëèÊ¨¢ËøéËÆøÈóÆÊú¨Á´ôÔºÅ</p>
        <p class="large-text">Ê≠£Âú®‰∏∫ÊÇ®Âä†ËΩΩÂíåÁºìÂ≠òÔºåÂàùÂßãÂåñÈ°µÈù¢‰∏≠...</p>
        <p class="large-text">‰∏ãÊ¨°ËøõÂÖ•ÂèØÂä†ÈÄüËÆøÈóÆÔºåËØ∑ËÄêÂøÉÁ≠âÂæÖ„ÄÇ</p>
        <p class="large-text">Ê≠§‰ø°ÊÅØ‰ªÖÂú®Êó†ÁºìÂ≠òÊó∂ÂºπÂá∫Ôºå5ÁßíÂêéËá™Âä®ÂÖ≥Èó≠ÔºÅ</p>
    </div>
</div>

 <!-- ÂºπÁ™óÊèêÈÜíÁªìÊùü -->
<div id="content" class="content-site customize-site" style="background:#18191c;">
    <style>
    .popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(27, 26, 26, 0.961);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: rgba(231, 128, 38, 0.974);
    text-align: center;
    padding: 20px;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 4px 10px rgba(26, 26, 26, 0.5);
}
@media (max-width: 480px) {
  .popup {
    width: 98%;
    max-width: 98vw;
    padding: 8px;
  }
  .large-text {
    font-size: 12px;
    word-break: break-all;
  }
  .category-title {
    font-size: 14px;
  }
  .page-nav, .pagination, .overflow-x-auto {
    max-width: 100vw;
    overflow-x: auto;
  }
}
.popup-content {
    max-width: 100%;
}

.large-text {
    font-size: 20px;
    color: #ea660e;
    margin: 15px 0;
    line-height: 1.5;
    letter-spacing: 4px;
}
@media (max-width: 768px) {
    .large-text {
        font-size: 14px;
    }
}
        .category-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #e0e0e0;
            display: flex;
            align-items: center;
            padding-bottom: 5px;
        }
        .category-title i {
             margin-right: 8px;
             color: #6c63ff;
        }

        body.io-black-mode .category-title {
             color: #e0e0e0;
        }
        .category-title i {
             color: #4a89f7;
        }
         body.io-black-mode .category-title i {
             color: #6c63ff;
         }

        .subcat-tabs {
            display: inline-flex;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
            margin-bottom: 20px;
            padding: 6px;
            background-color: #f1f3f5;
            border-radius: 25px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            scrollbar-width: none;
            -ms-overflow-style: none;
            max-width: 100%;
        }
        .subcat-tabs::-webkit-scrollbar {
            display: none;
        }

        .subcat-tab {
            padding: 8px 20px;
            border-radius: 20px;
            background: transparent;
            color: #6c757d;
            font-weight: 500;
            cursor: pointer;
            border: none;
            outline: none;
            margin-right: 0;
            flex-shrink: 0;
            transition: background 0.15s, color 0.15s;
        }

        .subcat-tab:hover {
            color: #212529;
            background-color: #c3c6c9;
        }

        .subcat-tab.active {
            background: #4a89f7;
            color: #fff;
            font-weight: 600;
            transform: scale(1.03);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }

        body.io-black-mode .subcat-tabs {
             background-color: #2a2a2e;
             box-shadow: none;
        }
        body.io-black-mode .subcat-tab {
            background: #40404009;
            color: #adb5bd;
        }
         body.io-black-mode .subcat-tab:hover {
             color: #fff;
             background-color: #555555;
         }
        body.io-black-mode .subcat-tab.active {
            background: #4a89f7;
            color: #fff;
            transform: scale(1.03);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
    </style>
    {{ $defaultLogo := $.Site.Params.defaultLogo }}
    {{ $logosPath := $.Site.Params.logosPath }}
    <link rel="preload" as="image" href="{{ $defaultLogo }}">

    {{ range $i, $cat := .Site.Data.webstack }}
        <div class="category-block mb-4" id="{{ if $cat.list }}{{ range first 1 $cat.list }}{{ md5 .term }}{{ end }}{{ else }}{{ md5 $cat.taxonomy }}{{ end }}">
            <div class="category-title">
                {{ if $cat.icon }}<i class="{{ $cat.icon }} icon-fw icon-lg"></i>{{ end }}
                {{ $cat.taxonomy }}
            </div>
            {{ if and $cat.list (gt (len $cat.list) 1) }}
                <div class="subcat-tabs">
                    {{ range $j, $sub := $cat.list }}
                        <button class="subcat-tab{{ if eq $j 0 }} active{{ end }}" data-cat="cat{{ $i }}" data-subcat="subcat{{ $i }}_{{ $j }}" id="{{ md5 $sub.term }}">{{ $sub.term }}</button>
                    {{ end }}
                </div>
                {{ range $j, $sub := $cat.list }}
                    <div class="row card-list" data-subcat="subcat{{ $i }}_{{ $j }}" id="{{ md5 (print $cat.taxonomy $sub.term) }}" style="{{ if ne $j 0 }}display:none;{{ end }}">
                        {{ range $k, $link := $sub.links }}
                        {{ $customLogo := cond (hasPrefix $link.logo "http") $link.logo (print $logosPath "/" $link.logo) }}
                        {{ $domain := replaceRE "^https?://([^/]+).*" "$1" $link.url }}
                        <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
                            <div class="url-body default">
                                <a href="{{ if $link.qrcode }}javascript:{{ else }}redirect.html?url={{ $link.url | safeURL }}{{ end }}"
                                   target="{{ if $link.qrcode }}_self{{ else }}_blank{{ end }}"
                                   class="card no-c mb-4"
                                   data-toggle="tooltip"
                                   data-placement="bottom"
                                   title="{{ if $link.qrcode }}<img src='{{ $logosPath }}/{{ $link.qrcode }}?width=128' width='128'>{{ else }}{{ $link.description }}{{ end }}">
                                    <div class="card-body">
                                        <div class="url-content d-flex align-items-center">
                                            <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                                <img class="lazy"
                                                     src="{{ $defaultLogo }}"
                                                     data-src="{{ $customLogo }}"
                                                     data-default="{{ $defaultLogo }}"
                                                     data-fallback="{{ $domain }}/favicon.ico || https://favicon.yandex.net/favicon/{{ $domain }} || https://www.google.com/s2/favicons?domain={{ $domain }}&size=64"
                                                     alt="{{ .title }}"
                                                     loading="lazy">
                                            </div>
                                            <div class="url-info flex-fill">
                                                <div class="text-sm overflowClip_1">
                                                    <strong>{{ $link.title }}</strong>
                                                </div>
                                                <p class="overflowClip_1 m-0 text-muted text-xs">{{ $link.description }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <a href="{{ $link.url | safeURL }}"
                                   class="togo text-center text-muted is-views"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="Áõ¥Ëææ" rel="nofollow"
                                   target="_blank">
                                    <i class="iconfont icon-goto"></i>
                                </a>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                {{ end }}
            {{ else if and $cat.list (eq (len $cat.list) 1) }}
                {{ range $j, $sub := $cat.list }}
                    <div class="row card-list">
                        {{ range $sub.links }}
                        {{ $customLogo := cond (hasPrefix .logo "http") .logo (print $logosPath "/" .logo) }}
                        {{ $domain := replaceRE "^https?://([^/]+).*" "$1" .url }}
                        <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
                            <div class="url-body default">
                                <a href="{{ if .qrcode }}javascript:{{ else }}redirect.html?url={{ .url | safeURL }}{{ end }}"
                                   target="{{ if .qrcode }}_self{{ else }}_blank{{ end }}"
                                   class="card no-c mb-4"
                                   data-toggle="tooltip"
                                   data-placement="bottom"
                                   title="{{ if .qrcode }}<img src='{{ $logosPath }}/{{ .qrcode }}?width=128' width='128'>{{ else }}{{ .description }}{{ end }}">
                                    <div class="card-body">
                                        <div class="url-content d-flex align-items-center">
                                            <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                                <img class="lazy"
                                                     src="{{ $defaultLogo }}"
                                                     data-src="{{ $customLogo }}"
                                                     data-default="{{ $defaultLogo }}"
                                                     data-fallback="{{ $domain }}/favicon.ico || https://favicon.yandex.net/favicon/{{ $domain }} || https://favicon.im/{{ $domain }} || https://www.google.com/s2/favicons?domain={{ $domain }}&size=64"
                                                     alt="{{ .title }}"
                                                     loading="lazy">
                                            </div>
                                            <div class="url-info flex-fill">
                                                <div class="text-sm overflowClip_1">
                                                    <strong>{{ .title }}</strong>
                                                </div>
                                                <p class="overflowClip_1 m-0 text-muted text-xs">{{ .description }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <a href="{{ .url | safeURL }}"
                                   class="togo text-center text-muted is-views"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="Áõ¥Ëææ" rel="nofollow"
                                   target="_blank">
                                    <i class="iconfont icon-goto"></i>
                                </a>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                {{ end }}
            {{ else }}
                <div class="row card-list">
                    {{ range $cat.links }}
                    {{ $customLogo := cond (hasPrefix .logo "http") .logo (print $logosPath "/" .logo) }}
                    {{ $domain := replaceRE "^https?://([^/]+).*" "$1" .url }}
                    <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
                        <div class="url-body default">
                            <a href="{{ if .qrcode }}javascript:{{ else }}redirect.html?url={{ .url | safeURL }}{{ end }}"
                               target="{{ if .qrcode }}_self{{ else }}_blank{{ end }}"
                               class="card no-c mb-4"
                               data-toggle="tooltip"
                               data-placement="bottom"
                               title="{{ if .qrcode }}<img src='{{ $logosPath }}/{{ .qrcode }}?width=128' width='128'>{{ else }}{{ .description }}{{ end }}">
                                <div class="card-body">
                                    <div class="url-content d-flex align-items-center">
                                        <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                            <img class="lazy"
                                                 src="{{ $defaultLogo }}"
                                                 data-src="{{ $customLogo }}"
                                                 data-default="{{ $defaultLogo }}"
                                                 data-fallback="{{ $domain }}/favicon.ico || https://favicon.yandex.net/favicon/{{ $domain }} ||  https://favicon.im/{{ $domain }} || https://www.google.com/s2/favicons?domain={{ $domain }}&size=64"
                                                 alt="{{ .title }}"
                                                 loading="lazy">
                                        </div>
                                        <div class="url-info flex-fill">
                                            <div class="text-sm overflowClip_1">
                                                <strong>{{ .title }}</strong>
                                            </div>
                                            <p class="overflowClip_1 m-0 text-muted text-xs">{{ .description }}</p>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <a href="{{ .url | safeURL }}"
                               class="togo text-center text-muted is-views"
                               data-toggle="tooltip"
                               data-placement="right"
                               title="Áõ¥Ëææ" rel="nofollow"
                               target="_blank">
                                <i class="iconfont icon-goto"></i>
                            </a>
                        </div>
                    </div>
                    {{ end }}
                </div>
            {{ end }}
        </div>
    {{ end }}

    <!-- ÂèãÊÉÖÈìæÊé• -->
    <h4 class="text-gray text-lg mb-4">
        <i class="iconfont icon-book-mark-line icon-lg mr-2" id="friendlink"></i>ÂèãÊÉÖÈìæÊé•
    </h4>
    <div class="friendlink text-xs card">
        <div class="card-body">
            {{ range .Site.Data.friendlinks }}
            <a href="redirect.html?url={{ .url | safeURL }}" title="{{ .description }}" target="_blank">{{ .title }}</a>
            {{ end }}
        </div>
    </div>
</div>
<script>
// ‰ºòÂåñÔºöÂõæÁâáÊáíÂä†ËΩΩÂíåÂàáÊç¢Êó∂È¢ÑÂä†ËΩΩÔºåÊèêÂçáÂàáÊç¢ÊµÅÁïÖÂ∫¶
document.addEventListener('DOMContentLoaded', function() {
    // Ê¨¢ËøéÂºπÁ™óÈÄªËæë
    var popup = document.getElementById('welcome-popup');
    var hasSeenPopup = false;
    try {
        hasSeenPopup = localStorage.getItem('hasSeenPopup');
    } catch (e) {
        hasSeenPopup = false;
    }
    if (!hasSeenPopup && popup) {
        popup.style.display = 'block';
        setTimeout(function() {
            popup.style.display = 'none';
        }, 5400);
        try {
            localStorage.setItem('hasSeenPopup', 'true');
        } catch (e) {}
    }

    // ‰∫åÁ∫ßÂàÜÁ±ªÂàáÊç¢ÈÄªËæëÔºåÂàáÊç¢Êó∂È¢ÑÂä†ËΩΩÂΩìÂâçÂç°ÁâáÂõæÁâá
    document.querySelectorAll('.subcat-tabs').forEach(function(tabBar){
        tabBar.querySelectorAll('.subcat-tab').forEach(function(tab){
            tab.addEventListener('click', function(){
                tabBar.querySelectorAll('.subcat-tab').forEach(t=>t.classList.remove('active'));
                tab.classList.add('active');
                const subcat = tab.getAttribute('data-subcat');
                const parent = tab.closest('.category-block');
                parent.querySelectorAll('.row.card-list[data-subcat]').forEach(list=>{
                    if (list.getAttribute('data-subcat') === subcat) {
                        list.style.display = '';
                        // È¢ÑÂä†ËΩΩÂΩìÂâçÊòæÁ§∫Âç°ÁâáÁöÑÂõæÁâá
                        list.querySelectorAll('img.lazy').forEach(img => {
                            if (!img._loaded) {
                                // Â¶ÇÊûúÂõæÁâáÊú™Âä†ËΩΩÔºåÁ°Æ‰øùsrc‰∏∫defaultLogo
                                if (!img.src || img.src === '' || img.src.endsWith('/') || img.src.endsWith('about:blank')) {
                                    img.src = img.dataset.default || "{{ $defaultLogo }}";
                                }
                                loadImage(img);
                            }
                        });
                    } else {
                        list.style.display = 'none';
                    }
                });
            });
        });
    });

    // hashÂàáÊç¢‰∫åÁ∫ßÂàÜÁ±ª
    function showSubcatByHash() {
        var hash = window.location.hash.replace('#', '');
        if (!hash) return;
        var btn = document.querySelector('.subcat-tab[id="' + hash + '"]');
        if (btn) btn.click();
        var block = document.getElementById(hash);
        if (block) block.scrollIntoView({behavior: "smooth"});
    }
    window.addEventListener('hashchange', showSubcatByHash);
    showSubcatByHash();

    // Â§ÑÁêÜ‰æßËæπÊ†èÁÇπÂáª
    window.handleSidebarClick = function(hash) {
        document.querySelectorAll('.subcat-tab').forEach(tab => tab.classList.remove('active'));
        const targetTab = document.querySelector(`.subcat-tab[id="${hash}"]`);
        if (targetTab) {
            targetTab.classList.add('active');
            const subcat = targetTab.getAttribute('data-subcat');
            const parent = targetTab.closest('.category-block');
            parent.querySelectorAll('.row.card-list[data-subcat]').forEach(list => {
                if (list.getAttribute('data-subcat') === subcat) {
                    list.style.display = '';
                    // È¢ÑÂä†ËΩΩÂΩìÂâçÊòæÁ§∫Âç°ÁâáÁöÑÂõæÁâá
                    list.querySelectorAll('img.lazy').forEach(img => {
                        if (!img._loaded) {
                            if (!img.src || img.src === '' || img.src.endsWith('/') || img.src.endsWith('about:blank')) {
                                img.src = img.dataset.default || "{{ $defaultLogo }}";
                            }
                            loadImage(img);
                        }
                    });
                } else {
                    list.style.display = 'none';
                }
            });
        }
        const targetBlock = document.getElementById(hash);
        if (targetBlock) {
            targetBlock.scrollIntoView({ behavior: "smooth" });
        }
    };

    // ÈîöÁÇπÂπ≥ÊªëÊªöÂä®ÔºåËÄÉËôëÂ§¥ÈÉ®È´òÂ∫¶
    const header = document.getElementById('header');
    const headerHeight = header ? header.offsetHeight : 0;
    document.body.addEventListener('click', function(event) {
        let targetLink = event.target.closest('a[href^="#"]');
        if (targetLink && targetLink.getAttribute('href').length > 1) {
            const hash = targetLink.getAttribute('href');
            const targetElement = document.getElementById(hash.substring(1));
            if (targetElement) {
                event.preventDefault();
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerHeight - 15;
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        }
    });

    // ÂõæÁâáÊáíÂä†ËΩΩ‰∏éÁºìÂ≠ò‰ºòÂåñ
    function loadImage(img) {
        if (img._loaded) return;
        const src = img.dataset.src;
        if (!src) {
            // Ê≤°Êúâdata-srcÔºåÁ°Æ‰øùÊòæÁ§∫defaultLogo
            if (img.dataset.default && img.src !== img.dataset.default) {
                img.src = img.dataset.default;
            }
            return;
        }
        // ‰ºòÂÖàÂ∞ùËØïÁºìÂ≠ò
        let cached = false;
        try {
            const cachedData = localStorage.getItem(src);
            if (cachedData) {
                img.src = cachedData;
                img._loaded = true;
                img.removeAttribute('data-src');
                cached = true;
            }
        } catch (e) {}
        if (!cached) {
            img.src = src;
            img.onload = function() {
                try {
                    localStorage.setItem(src, img.src);
                } catch (e) {}
                img._loaded = true;
                img.removeAttribute('data-src');
            };
            img.onerror = function() {
                multiFallback(img);
            };
        }
    }

    // Â§öÁ∫ßÂõûÈÄÄÂ§ÑÁêÜÂô®ÔºåÁ°Æ‰øùÂàáÊç¢Êó∂‰πüËÉΩÂø´ÈÄü fallback
    function multiFallback(img) {
        let fallbacks = img.dataset.fallback ? img.dataset.fallback.split('||').map(s => s.trim()) : [];
        let idx = 0;
        function tryNext() {
            if (idx < fallbacks.length) {
                img.onerror = tryNext;
                img.src = fallbacks[idx++];
            } else {
                img.onerror = null;
                img.src = img.dataset.default || "{{ $defaultLogo }}";
            }
        }
        tryNext();
    }

    // IntersectionObserver ÊáíÂä†ËΩΩ
    function lazyLoadImages() {
        const lazyImages = document.querySelectorAll('.lazy[data-src]:not(._observed)');
        if ('IntersectionObserver' in window) {
            const observer = new window.IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Á°Æ‰øùÊú™Âä†ËΩΩÊó∂ÊòæÁ§∫defaultLogo
                        if (!entry.target._loaded && (!entry.target.src || entry.target.src === '' || entry.target.src.endsWith('/') || entry.target.src.endsWith('about:blank'))) {
                            entry.target.src = entry.target.dataset.default || "{{ $defaultLogo }}";
                        }
                        loadImage(entry.target);
                        obs.unobserve(entry.target);
                    }
                });
            }, { rootMargin: '100px' });
            lazyImages.forEach(img => {
                observer.observe(img);
                img.classList.add('_observed');
            });
        } else {
            // ‰∏çÊîØÊåÅ IntersectionObserver Êó∂ÈôçÁ∫ß
            lazyImages.forEach(img => {
                if (img.getBoundingClientRect().top < window.innerHeight + 100 && img.dataset.src) {
                    if (!img._loaded && (!img.src || img.src === '' || img.src.endsWith('/') || img.src.endsWith('about:blank'))) {
                        img.src = img.dataset.default || "{{ $defaultLogo }}";
                    }
                    loadImage(img);
                }
            });
        }
    }

    // Â±ïÂºÄÊâÄÊúâÈ°µÈù¢Âùó
    document.querySelectorAll('.page-content').forEach(page => {
        page.style.display = 'block';
    });

    // ÂàùÂßãÊáíÂä†ËΩΩ
    lazyLoadImages();
    window.addEventListener('scroll', lazyLoadImages, {passive:true});
    window.addEventListener('resize', lazyLoadImages);

    // ÂàáÊç¢Êó∂È¢ÑÂä†ËΩΩÂΩìÂâçÂèØËßÅÂç°ÁâáÂõæÁâá
    document.querySelectorAll('.row.card-list').forEach(list => {
        if (list.style.display !== 'none') {
            list.querySelectorAll('img.lazy').forEach(img => {
                if (!img._loaded) {
                    if (!img.src || img.src === '' || img.src.endsWith('/') || img.src.endsWith('about:blank')) {
                        img.src = img.dataset.default || "{{ $defaultLogo }}";
                    }
                    loadImage(img);
                }
            });
        }
    });
});
</script>
<!-- ÂºπÁ™óÊèêÈÜíÁªìÊùü -->
